<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${document.title} + ' - Link-Notion'">Link-Notion</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 8px; min-height: 80vh; }
        .doc-title { font-size: 2.5rem; font-weight: bold; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .doc-content { font-size: 1.1rem; line-height: 1.6; color: #333; }
        .footer { margin-top: 50px; padding-top: 20px; border-top: 1px solid #eee; text-align: center; color: #888; }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="doc-title" th:text="${document.title}">Document Title</h1>

        <div class="doc-content" id="content">
            <!-- Markdown will be rendered here -->
        </div>

        <textarea id="raw-content" style="display:none;" th:text="${document.content}"></textarea>

        <!-- Comments Section -->
        <div class="mt-5">
            <h4>Comments</h4>
            <div th:if="${username != null}">
                <form th:action="@{/share/{uuid}/comment(uuid=${document.uuid})}" method="post" class="mb-4">
                    <div class="mb-2">
                        <textarea name="content" class="form-control" rows="3" placeholder="Leave a comment..." required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm">Post Comment</button>
                </form>
            </div>
            <div th:if="${username == null}" class="alert alert-light border">
                Please <a href="/login">login</a> to leave a comment.
            </div>

            <div class="list-group">
                <div th:each="comment : ${comments}" class="list-group-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1" th:text="${comment.author.username}">Author</h6>
                        <small th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}">Date</small>
                    </div>
                    <p class="mb-1" th:text="${comment.content}">Content</p>
                    <div th:if="${username == comment.author.username}">
                        <form th:action="@{/share/{uuid}/comment/{id}/delete(uuid=${document.uuid}, id=${comment.id})}" method="post">
                             <button type="submit" class="btn btn-link btn-sm text-danger p-0" style="text-decoration:none;">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <small>Hosted by <a href="/">Link-Notion</a></small>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
    <script>
        const rawContent = document.getElementById('raw-content').value;
        const dirtyHtml = marked.parse(rawContent);
        const cleanHtml = DOMPurify.sanitize(dirtyHtml);
        document.getElementById('content').innerHTML = cleanHtml;
    </script>

</body>
</html>
